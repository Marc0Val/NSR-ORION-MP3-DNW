services:
  # El Músculo: Encargado de descargas y telemetría
  harvester:
    build: 
      context: ./src/harvester
      dockerfile: Dockerfile
    container_name: orion_harvester
    restart: unless-stopped
    volumes:
      # Las rutas de volúmenes siguen siendo relativas a este archivo YAML
      - ${BASE_STORAGE_PATH}:/app/downloads
      - ./config:/app/config
    environment:
      - MQTT_BROKER=${MQTT_BROKER}
      - BASE_STORAGE_PATH=/app/downloads
    networks:
      - orion_network
  
  gateway:
    build:
      context: ./src/gateway
      dockerfile: Dockerfile
    container_name: orion_gateway
    restart: unless-stopped
    ports:
      - "5000:5000"
    volumes:
      - ${BASE_STORAGE_PATH}:/app/downloads
      - ./src/gateway:/app
    environment:
      - BASE_STORAGE_PATH=/app/downloads
    networks:
      - orion_network

networks:
  orion_network:
    driver: bridge